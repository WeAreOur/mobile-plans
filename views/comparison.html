<div class="container">
  <header class="header">
    <h1 id="page-title">Mobile Plans - Comparison</h1>
    
    <div class="controls">
      <button id="theme-toggle" onclick="WAO.toggleTheme()" aria-label="Toggle dark mode">
        <span id="theme-icon">◐</span> Theme
      </button>
      
      <select id="country-select" onchange="WAO.updateConfig({ country: this.value })" style="display: none;">
        <option value="uk">United Kingdom</option>
        <option value="us">United States</option>
      </select>
      
      <select id="locale-select" onchange="WAO.updateConfig({ locale: this.value })" style="display: none;">
        <option value="en">English</option>
        <option value="ar">العربية</option>
        <option value="he">עברית</option>
      </select>
      
      <select id="view-select" onchange="WAO.updateConfig({ view: this.value })">
        <option value="providers">Cards</option>
        <option value="comparison" selected>Table</option>
      </select>
      
      <select id="sort-select" onchange="WAO.sortPlans(this.value)">
        <option value="price-asc" selected>Price: Low to High</option>
        <option value="price-desc">Price: High to Low</option>
        <option value="data-asc">Data: Low to High</option>
        <option value="data-desc">Data: High to Low</option>
        <option value="provider-asc">Provider: A to Z</option>
        <option value="provider-desc">Provider: Z to A</option>
      </select>
      
      <select id="filter-price-rise" onchange="WAO.applyFilters()">
        <option value="all">All Plans</option>
        <option value="no-rises">No Price Rises Only</option>
        <option value="with-rises">With Price Rises</option>
      </select>
      
      <select id="filter-5g" onchange="WAO.applyFilters()">
        <option value="all">All Networks</option>
        <option value="5g-only">5G Only</option>
      </select>
      
      <select id="filter-contract" onchange="WAO.applyFilters()">
        <option value="all">All Contracts</option>
        <option value="1-month">1 Month</option>
        <option value="12-months">12 Months</option>
        <option value="24-months">24 Months</option>
      </select>
      
      <select id="filter-network" onchange="WAO.applyFilters()">
        <option value="all">All Networks</option>
        <option value="EE">EE</option>
        <option value="Vodafone">Vodafone</option>
        <option value="Three">Three</option>
        <option value="O2">O2</option>
      </select>
    </div>
  </header>

  <div class="table-container">
    <table id="comparison-table" class="comparison-table">
      <thead>
        <tr>
          <th id="th-provider">Provider</th>
          <th id="th-plan">Plan</th>
          <th id="th-price">Price</th>
          <th id="th-data">Data</th>
          <th id="th-minutes">Minutes</th>
          <th id="th-contract">Contract</th>
          <th id="th-roaming">Roaming</th>
          <th id="th-status">Last Reviewed</th>
          <th id="th-link">Link</th>
        </tr>
      </thead>
      <tbody id="table-body"></tbody>
    </table>
  </div>
  
  <footer class="footer">
    <p>
      <span id="data-attribution"></span> • 
      <a href="https://github.com/WeAreOur/mobile-plans">Contribute on GitHub</a> • 
      <a href="/legal/LICENSE.md">CC-BY-SA 4.0</a> • 
      <a href="/legal/PRIVACY.md">Privacy</a> • 
      <a href="/legal/TERMS.md">Terms</a> • 
      <a href="/docs/GOVERNANCE.md">Governance</a>
    </p>
  </footer>
</div>

<script>
  function renderTable(providers) {
    const tbody = document.getElementById('table-body');
    tbody.innerHTML = providers.map(plan => `
      <tr>
        <td class="provider-cell">${plan.provider.name}</td>
        <td>${plan.name}</td>
        <td class="price-cell">${WAO.formatCurrency(plan.price, plan.currency)}/mo</td>
        <td>${plan.data}</td>
        <td>${plan.minutes || 'N/A'}</td>
        <td>${plan.contractLength || 'N/A'}</td>
        <td>${WAO.formatRoaming(plan.roaming)}</td>
        <td>
          <span class="badge badge-review-date">
            ${plan.metadata.sources[0].accessDate}
          </span>
        </td>
        <td>
          <a href="${plan.metadata.sources[0].url}" target="_blank" rel="noopener">
            ${window.t('view_plan')}
          </a>
        </td>
      </tr>
    `).join('');
  }
  
  window.initView = function() {
    const { providers, meta } = window.currentData;
    const attribution = document.getElementById('data-attribution');
    
    // Update title and headers
    document.getElementById('page-title').textContent = window.t('title') + ' - Comparison';
    document.getElementById('th-provider').textContent = window.t('provider');
    document.getElementById('th-plan').textContent = 'Plan';
    document.getElementById('th-price').textContent = window.t('price');
    document.getElementById('th-data').textContent = window.t('data');
    document.getElementById('th-minutes').textContent = window.t('minutes');
    document.getElementById('th-contract').textContent = window.t('contract');
    document.getElementById('th-roaming').textContent = 'Roaming';
    document.getElementById('th-status').textContent = 'Last Reviewed';
    document.getElementById('th-link').textContent = 'Link';
    
    // Filter to show only verified and complete plans
    const allProviders = providers.filter(plan => 
      plan.status === 'complete' && plan.metadata.confidence === 'verified'
    );
    
    // Initialize WAO with data and render callback
    WAO.init(allProviders, renderTable);
    
    // Update attribution
    attribution.textContent = `${meta.country} • ${allProviders.length} plans`;
  };
</script>
